# データベース設計の変更履歴（2024/02/13）

## 変更理由
1. **目標と看板の関係性の明確化**
   - 当初：単純な1対多の関係
   - 変更後：双方向の参照関係を追加（`parent_goal_id`）
   - 理由：大目標から小目標への階層構造をより柔軟に表現するため

2. **テーブル名の変更**
   - 当初：`users`テーブル
   - 変更後：`profiles`テーブル
   - 理由：Supabase Authの`auth.users`との役割の明確化

3. **インデックス設計の追加**
   - 検索性能の向上
   - ユーザー体験の改善
   - 将来的なスケーリングへの対応

4. **セキュリティポリシーの具体化**
   - RLSポリシーの命名規則の統一
   - アクセス制御の明確化

## 主な変更点
1. テーブル構成の変更
   - `users` → `profiles`（名称変更）
   - `boards.parent_goal_id`の追加
   - タイムスタンプ型の統一（`timestamptz`）

2. 制約の追加
   - ユーザー名の最小長チェック
   - 目標タイプと状態の列挙型チェック
   - 外部キー制約の整理

3. インデックスの追加
   - プロフィール：`username`
   - 看板：`user_id`, `parent_goal_id`
   - 目標：`user_id`, `board_id`, `type`, `status`

## 移行計画
1. マイグレーションファイルの更新
2. テストデータの調整
3. フロントエンド側の型定義更新

以上の変更により、アプリケーションの要件により適した
データベース構造となりました。 